@page "/account/register"
@attribute [AllowAnonymous]
@using HouseKeeper.Components.Routing

<PageTitle>Register</PageTitle>

<section class="account-page">
    <header>
        <h1>Create account</h1>
    </header>

    @if (!string.IsNullOrWhiteSpace(Error))
    {
        <p class="account-page__error" role="alert" aria-live="assertive">@Error</p>
    }

    <form method="post" action="@AppRoutes.Register" class="account-form">
        <AntiforgeryToken />
        <input type="hidden" name="returnUrl" value="@NormalizedReturnUrl" />

        <label>
            Username
            <input type="text" name="Username" maxlength="32" minlength="3" required autocomplete="username" />
        </label>

        <label>
            Email
            <input type="email" name="Email" maxlength="120" required autocomplete="email" />
        </label>

        <label>
            Password
            <input type="password" name="Password" minlength="8" maxlength="120" required autocomplete="new-password" />
        </label>

        <label>
            Confirm password
            <input type="password" name="ConfirmPassword" minlength="8" maxlength="120" required autocomplete="new-password" />
        </label>

        <button type="submit">Create account</button>
    </form>

    <p>
        Already registered?
        <a href="@($"{AppRoutes.Login}?returnUrl={Uri.EscapeDataString(NormalizedReturnUrl)}")">Log in</a>
    </p>
</section>

@code {
    [SupplyParameterFromQuery(Name = "error")] public string? Error { get; set; }
    [SupplyParameterFromQuery(Name = "returnUrl")] public string? ReturnUrl { get; set; }

    private string NormalizedReturnUrl => !string.IsNullOrWhiteSpace(ReturnUrl) && ReturnUrl.StartsWith('/')
        ? ReturnUrl
        : AppRoutes.Home;
}
